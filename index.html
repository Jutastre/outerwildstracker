<!DOCTYPE html>

<html>

<head>

  <link rel="stylesheet" href="style.css">

  <title>Outer Wilds Progress Tracker</title>

</head>

<body>

  <h1>Outer Wilds Progress Tracker</h1>

  <p>Current URL: <span id="current-url"></span></p>

  <form>
    <!-- <h2>BBThe Attlerock</h2>
    <h3>BBEsker's Camp</h3>
    <label>BBVisited: </label><input type="checkbox" id="bbeskerscamp" />

    <label>BBSpoken to Esker: </label><input type="checkbox" id="bbeskerscamp_speech" /> 
    <label>BBEsker's signal identified: </label><input type="checkbox" id="bbeskerscamp_signal" /> 
    <label>BBVisited: </label><input type="checkbox" id="bbeskerscamp" />

    <label>BBSpoken to Esker: </label><input type="checkbox" id="bbeskerscamp_speech" /> 
    <label>BBEsker's signal identified: </label><input type="checkbox" id="bbeskerscamp_signal" />  -->

    <span id="progress_tracker"></span>
  </form>


  <script>

    const planets = [
        {
            name:"Timber Hearth",
            pois:[
                  "Obtained launch codes",
                  "Explored the Zero-G cave"
            ]
        },
        {
            name:"The Attlerock",
            pois:[
                  "Visited Esker's Camp",
                  "Spoken to Esker",
                  "Identified Eskers Signal",
                  "Explored the Locator"
            ]
        },
      ];

    const url = new URL(window.location.href);

    const params = new URLSearchParams(url.search);


    numerical_data = 0;

    unused_id = 0;

    planets.forEach((planet) => {
      tracker = document.getElementById('progress_tracker');
      header = document.createElement('h2');
      header.innerHTML = planet.name;
      span = document.createElement('span');

      planet.pois.forEach((poi) => {
        label = document.createElement('span');
        label.innerHTML = '\n' + poi + ': ';
        box = document.createElement('input');
        box.type = "checkbox";
        box.id = unused_id;
        unused_id = unused_id + 1;
        span.appendChild(label);
        span.appendChild(box);
      });
      tracker.appendChild(header);
      tracker.appendChild(span);
    });

    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    function update_url(){
      idx_value = 1;
      numerical_data = 0;
      checkboxes.forEach((checkbox) => {
        if (checkbox.checked) {
          numerical_data += idx_value;
        }
        idx_value *= 2;
      });

      params.set("p", numerical_data);
      url.search = params.toString();

      window.history.replaceState({}, '', url.href);

      document.getElementById('current-url').textContent = url.href;
    };

    checkboxes.forEach((checkbox) => {
      console.log("registering id:" + checkbox.id)
      checkbox.addEventListener('change', update_url);

    });


    // Initialize checkbox states from URL query parameter

    const paramValue = params.get("p");
    idx_value = 1;
    checkboxes.forEach((checkbox) => {


      if (paramValue & idx_value) {
        checkbox.checked = true;
      } else {
        checkbox.checked = false;
      }
      idx_value *= 2;
    });

  </script>

</body>

</html>
